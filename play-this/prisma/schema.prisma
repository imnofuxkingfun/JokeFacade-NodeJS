datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client"
  output   = "./generated"
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(50)
  users User[]
}

model User {
  id              Int              @id @default(autoincrement())
  email           String           @unique @db.VarChar(255)
  password        String           @db.VarChar(255)
  username        String           @unique @db.VarChar(100)
  roleId          Int              @map("role_id")
  role            Role             @relation(fields: [roleId], references: [id], onDelete: Restrict)
  profile         Profile?
  likedSongs      UserLikedSong[]
  blogs           Blog[]
  comments Comment[]

  @@index([email])
  @@index([username])
  @@index([roleId])
}

model Profile {
  idUser      Int       @id @map("id_user")
  displayName String?   @map("display_name") @db.VarChar(100)
  dob         DateTime? @db.Date
  bio         String?   @db.Text
  user        User      @relation(fields: [idUser], references: [id], onDelete: Cascade)
}

model Genre {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(100)
  songs Song[]
}

model Artist {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(255)
  description String? @db.Text
  songs       Song[]
}

model Song {
  id          Int             @id @default(autoincrement())
  name        String          @db.VarChar(255)
  length      Int
  genreId     Int?            @map("genre_id")
  artistId    Int?            @map("artist_id")
  genre       Genre?          @relation(fields: [genreId], references: [id], onDelete: SetNull)
  artist      Artist?         @relation(fields: [artistId], references: [id], onDelete: SetNull)
  likedBy     UserLikedSong[]
  blogs       Blog[]

  @@index([genreId])
  @@index([artistId])
}

model UserLikedSong {
  idUser Int  @map("id_user")
  idSong Int  @map("id_song")
  user   User @relation(fields: [idUser], references: [id], onDelete: Cascade)
  song   Song @relation(fields: [idSong], references: [id], onDelete: Cascade)

  @@id([idUser, idSong])
  @@map("user_liked_songs")
}

model Blog {
  id     Int       @id @default(autoincrement())
  idUser Int       @map("id_user")
  text   String    @db.Text
  date   DateTime  @default(now()) @db.Timestamp()
  review Int?      @db.SmallInt
  songId Int?      @map("song_id")
  user   User      @relation(fields: [idUser], references: [id], onDelete: Cascade)
  song   Song?     @relation(fields: [songId], references: [id], onDelete: SetNull)
  comments Comment[]

  @@index([idUser])
  @@index([songId])
  @@index([date])
  @@map("blogs")
}


model Comment {
  id     Int      @id @default(autoincrement())
  idUser Int      @map("id_user")
  idBlog Int      @map("id_blog")
  text   String   @db.Text
  date   DateTime @default(now()) @db.Timestamp()
  user   User     @relation(fields: [idUser], references: [id], onDelete: Cascade)
  blog   Blog     @relation(fields: [idBlog], references: [id], onDelete: Cascade)

  @@index([idUser])
  @@index([idBlog])
  @@index([date])
  @@map("comments")
}